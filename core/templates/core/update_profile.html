{% extends 'base.html' %}
{% load cloudinary %}
{% block content %}
{% if user_form.errors %}
    <div role="alert">
        {%for key, value in user_form.errors.items %}
            <div>
                <strong>{{ value  }}</strong>
            </div>
        {% endfor %}
    <button type="button" data-dismiss="alert"></button>
    </div>
{% endif %}
<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="form_group">
        <label>Username:</label>
        {{user_form.username}}
    </div>
    <div class="form_group">
        <label>Email:</label>
        {{ profile_form.email}}
        <label>Bio:</label>
        {{profile_form.bio}}
        <label>Location:</label>
        {{profile_form.location}}
        <label>Image:</label>
        {{profile_form.profile_img}}
    </div>
    <button type="submit">Update Profile</button>
    <button type="reset">Reset</button>
    
</form>


<div>
    <h2>Delete Account</h2>
    
    <form method="post" action="{% url 'core:remove' %}">
        {% csrf_token %}
        <button type="submit">deactivate account</button>
    </form>

</div>
{%endblock%}

<script type="text/javascript">
    const url = "https://api.cloudinary.com/v1_1/demo/image/upload";
    const form = document.querySelector("form");

    form.addEventListener("submit", (e) => {
        e.preventDefault();

    const files = document.querySelector("[type=file]").files;
    const formData = new FormData();

    for (let i = 0; i < files.length; i++) {
        let file = files[i];
        formData.append("file", file);
        formData.append("upload_preset", "docs_upload_example_us_preset");

    fetch(url, {
        method: "POST",
        body: formData
    })
    .then((response) => {
        return response.text();
    })
    .then((data) => {
        document.getElementById("data").innerHTML += data;
    });
    }
});
</script>

<!-- <button id="upload_widget" class="cloudinary-button">Upload files</button> -->

<!-- <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>  

<script type="text/javascript">  

    var myWidget = cloudinary.createUploadWidget({
        cloudName: 'limn',
        upload_preset: 'preset1',
        }, (error, result) => { if (result.event == "success") {
            console.log(result.info) // result.info contains data from upload
        } })

        document.getElementById("upload_widget").addEventListener("click", function(){
            myWidget.open();
        }, false);
    
</script> -->